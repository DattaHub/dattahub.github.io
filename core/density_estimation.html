<!DOCTYPE html>
<html lang="en"><head>
<script src="density_estimation_files/libs/clipboard/clipboard.min.js"></script>
<script src="density_estimation_files/libs/quarto-html/tabby.min.js"></script>
<script src="density_estimation_files/libs/quarto-html/popper.min.js"></script>
<script src="density_estimation_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="density_estimation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="density_estimation_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="density_estimation_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <meta name="author" content="Dr.&nbsp;Jyotishka Datta">
  <title>Nonparametric   Density Estimation   An Introduction</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="density_estimation_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="density_estimation_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="density_estimation_files/libs/revealjs/dist/theme/quarto-48515d7f0f0f3be0bf802a3a9720c741.css">
  <link href="density_estimation_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="density_estimation_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="density_estimation_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="density_estimation_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Nonparametric <br> Density Estimation <br> An Introduction</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Dr.&nbsp;Jyotishka Datta 
</div>
</div>
</div>

</section>
<section id="density-estimation" class="slide level2">
<h2>Density Estimation</h2>
<p>Suppose a random sample <span class="math inline">\(X_1, \ldots, X_n\)</span> is drawn from a population with an unknown continuous probability density function <span class="math inline">\(f(x)\)</span>.</p>
<p>Goal: estimate <span class="math inline">\(f(x)\)</span>.</p>
<h3 id="histogram">Histogram</h3>
<p>Partition the range of data into subintervals:</p>
<p><span class="math display">\[
a_1 &lt; a_2 &lt; \cdots &lt; a_k.
\]</span></p>
<p>For <span class="math inline">\(x \in (a_i, a_{i+1}]\)</span>, <span class="math display">\[
\hat f(x) =
\frac{\#\{\text{observations} \in (a_i, a_{i+1}]\}}{n(a_{i+1} - a_i)}.
\]</span></p>
</section>
<section id="bandwidth" class="slide level2">
<h2>Bandwidth</h2>
<ul>
<li><p>Typically, the intervals have equal length <span class="math inline">\(h\)</span>: <span class="math inline">\((a_{i+1} - a_i) = 2h\)</span> for <span class="math inline">\(i = 1, \ldots, k\)</span>. The equal interval length <span class="math inline">\(h\)</span> is often referred to as the <strong>bandwidth</strong>.</p></li>
<li><p>In this case, for any <span class="math inline">\(x\)</span> within the data range, <span class="math display">\[
\hat f(x) =
\frac{\#\{\text{observations within } h \text{ of } x\}}{2nh}
= \frac{1}{2nh} \sum_{i=1}^n I(|X_i - x| \le h).
\]</span></p></li>
<li><p>Narrow intervals (smaller <span class="math inline">\(h\)</span>): histogram has a choppy appearance, large variance.</p></li>
<li><p>Large intervals (larger <span class="math inline">\(h\)</span>): histogram may lose local features, large bias.</p></li>
</ul>
</section>
<section id="bandwidth-1" class="slide level2">
<h2>Bandwidth</h2>
<ul>
<li>Generally, a larger sample size <span class="math inline">\(n\)</span> requires a smaller <span class="math inline">\(h\)</span>, thus more intervals.</li>
</ul>
<p>Suggested bandwidth: <span class="math display">\[
h = \frac{1.75}{n^{1/3}} S,
\]</span> where <span class="math inline">\(S\)</span> is the sample standard deviation.</p>
</section>
<section id="histograms" class="slide level2">
<h2>Histograms</h2>
<ul>
<li><p>Histograms provide an idea about the data distribution.</p></li>
<li><p>Look at the definition again:</p></li>
</ul>
<p><span class="math display">\[
\hat{f}(x) = \frac{ \text{No. of observations within } h \text{ of } x }{n \times 2h} \\
\]</span> or,</p>
<p><span class="math display">\[
    \hat{f}(x) = \frac{1}{2nh} \sum_{i=1}^{n} I(|{X_i - x}| \le h).
\]</span></p>
<ul>
<li>Narrow intervals (smaller h): histogram has a choppy appearance, large variance.</li>
<li>Large intervals (larger h): histogram may lose the local feature, large bias.</li>
</ul>
</section>
<section id="r-hist" class="slide level2 scrollable">
<h2>R <code>hist()</code></h2>
<ul>
<li><p>In base R’s <code>hist()</code> method, you can use the <code>break</code> argument:</p></li>
<li><p><code>breaks</code> can be one of:</p></li>
</ul>
<ol type="1">
<li>a vector giving the breakpoints between histogram cells,</li>
<li>a function to compute the vector of breakpoints,</li>
<li>a single number giving the number of cells for the histogram,</li>
<li>a character string naming an algorithm to compute the number of cells (see ‘Details’),</li>
<li>a function to compute the number of cells.</li>
</ol>
</section>
<section id="sampling-distribution" class="slide level2">
<h2>Sampling distribution</h2>
<ul>
<li>By default, number of breaks is calculated by using Sturges’ formula.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="fu">data</span>(mtcars)</span>
<span id="cb1-2"><a href=""></a><span class="fu">hist</span>(mtcars<span class="sc">$</span>mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-1-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="histogram-with-different-number-of-bins" class="slide level2">
<h2>Histogram with different number of bins</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a><span class="fu">hist</span>(mtcars<span class="sc">$</span>mpg, <span class="at">breaks=</span><span class="dv">12</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-2-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="different-h" class="slide level2">
<h2>Different h</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href=""></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb3-2"><a href=""></a><span class="fu">hist</span>(mtcars<span class="sc">$</span>mpg, <span class="at">breaks=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb3-3"><a href=""></a><span class="fu">hist</span>(mtcars<span class="sc">$</span>mpg, <span class="at">breaks=</span><span class="dv">8</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb3-4"><a href=""></a><span class="fu">hist</span>(mtcars<span class="sc">$</span>mpg, <span class="at">breaks=</span><span class="dv">12</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb3-5"><a href=""></a><span class="fu">hist</span>(mtcars<span class="sc">$</span>mpg, <span class="at">breaks=</span><span class="dv">20</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb3-6"><a href=""></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="different-h-1" class="slide level2">
<h2>Different h</h2>

<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-4-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="kernel-density-estimation" class="slide level2">
<h2>Kernel Density Estimation</h2>
<ul>
<li><p>Drawback of histogram: density estimation is piecewise constant and thus unsmooth.</p></li>
<li><p>Main idea of kernel density estimation: instead of counting number of observations within <span class="math inline">\(h\)</span> of <span class="math inline">\(x\)</span>, we take a certain weighted average of data points near <span class="math inline">\(x\)</span> to estimate <span class="math inline">\(f(x)\)</span>.</p></li>
<li><p>Usually we assign higher weights to data points closer to <span class="math inline">\(x\)</span>, and lower weights to those further away from <span class="math inline">\(x\)</span>.</p></li>
<li><p>Kernel Density Estimate:</p></li>
</ul>
<p><span class="math display">\[
    \hat{f}(x) = \frac{1}{nh} \sum_{i=1}^{n} K\left(\frac{|{X_i - x|}}{h}\right).
\]</span> where <span class="math inline">\(K(\cdot)\)</span> is a Kernel function.</p>
<ul>
<li>Choices: <span class="math inline">\(h\)</span> bandwidth and <span class="math inline">\(K()\)</span> the kernel.</li>
</ul>
</section>
<section id="choices-of-kernel-function" class="slide level2">
<h2>Choices of kernel function</h2>
<ul>
<li>Uniform: <span class="math inline">\(K(u) = \frac{1}{2} I(|u| \le 1)\)</span>. Reduces to histogram.</li>
<li>Gaussian: <span class="math inline">\(K(u) = \phi(u)\)</span> (standard normal density).</li>
<li>Triangle: <span class="math inline">\(K(u) = (1 - |u|) I(|u| \le 1)\)</span>.</li>
<li>Epanechnikov: <span class="math inline">\(K(u) = \tfrac{3}{4}(1 - u^2) I(|u| \le 1)\)</span>.</li>
<li>Biweight: <span class="math inline">\(K(u) = \tfrac{15}{16}(1 - u^2)^2 I(|u| \le 1)\)</span>.</li>
<li>Triweight: <span class="math inline">\(K(u) = \tfrac{35}{32}(1 - u^2)^3 I(|u| \le 1)\)</span>.</li>
<li>Minimum variance kernel (allowing negative weight):</li>
</ul>
<p><span class="math display">\[
  K(u) = \tfrac{1}{8}(3 - 5u^2) I(|u| \le 1).
\]</span></p>
</section>
<section id="choice-of-bandwidth-h" class="slide level2">
<h2>Choice of bandwidth <span class="math inline">\(h\)</span></h2>
<p>A rule of thumb (Harfle, 1991): <span class="math display">\[
h = \frac{1.06}{n^{1/5}} S,
\]</span> where <span class="math inline">\(S\)</span> is the sample standard deviation, or a more robust version such as</p>
<ul>
<li>scaled interquartile range: <span class="math display">\[
S = \frac{X_{(0.75)} - X_{(0.25)}}{1.34},
\]</span></li>
<li>scaled MAD (median absolute deviation): <span class="math display">\[
S = 1.4826 \cdot \text{Median}\{|X_i - \text{median}(X_i)|\}.
\]</span></li>
</ul>
</section>
<section id="kernel-function-shapes" class="slide level2">
<h2>Kernel function shapes</h2>

<img data-src="density_estimation_files/figure-revealjs/kernel-shapes-1.png" class="quarto-figure quarto-figure-center r-stretch" width="768"></section>
<section id="kernel-density-plot" class="slide level2">
<h2>Kernel Density Plot</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a>d <span class="ot">&lt;-</span> <span class="fu">density</span>(mtcars<span class="sc">$</span>mpg) <span class="co"># returns the density data </span></span>
<span id="cb4-2"><a href=""></a><span class="fu">plot</span>(d) <span class="co"># plots the results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-5-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="kernel-density-plot-with-13rd-bandwith" class="slide level2">
<h2>Kernel Density Plot with 1/3rd bandwith</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a>d <span class="ot">&lt;-</span> <span class="fu">density</span>(mtcars<span class="sc">$</span>mpg,<span class="at">adjust =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="co"># returns the density data </span></span>
<span id="cb5-2"><a href=""></a><span class="fu">plot</span>(d) <span class="co"># plots the results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-6-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="kernel-density-plot-with-2x-bandwith" class="slide level2">
<h2>Kernel Density Plot with 2x bandwith</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href=""></a>d <span class="ot">&lt;-</span> <span class="fu">density</span>(mtcars<span class="sc">$</span>mpg,<span class="at">adjust =</span> <span class="dv">2</span>) <span class="co"># returns the density data </span></span>
<span id="cb6-2"><a href=""></a><span class="fu">plot</span>(d) <span class="co"># plots the results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-7-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="kernel-density-plot-with-a-rectangular-kernel" class="slide level2">
<h2>Kernel Density Plot with a rectangular kernel</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a>d <span class="ot">&lt;-</span> <span class="fu">density</span>(mtcars<span class="sc">$</span>mpg, <span class="at">kernel =</span> <span class="st">"rectangular"</span>) <span class="co"># returns the density data </span></span>
<span id="cb7-2"><a href=""></a><span class="fu">plot</span>(d) <span class="co"># plots the results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-8-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="kernel-density-plot-with-the-epanechnikov-kernel" class="slide level2">
<h2>Kernel Density Plot with the Epanechnikov kernel</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a>d <span class="ot">&lt;-</span> <span class="fu">density</span>(mtcars<span class="sc">$</span>mpg, <span class="at">kernel =</span> <span class="st">"epanechnikov"</span>) <span class="co"># returns the density data </span></span>
<span id="cb8-2"><a href=""></a><span class="fu">plot</span>(d) <span class="co"># plots the results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-9-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="faithful-geyser" class="slide level2">
<h2>Faithful Geyser</h2>
<ul>
<li><p>Data set faithful contains 272 durations (mins) of the eruptions of Old Faithful geyser.</p></li>
<li><p>Take a look at the data set (the first 5 observations)</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a>faithful[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  eruptions waiting
1     3.600      79
2     1.800      54
3     3.333      74
4     2.283      62
5     4.533      85</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a>duration <span class="ot">=</span> faithful<span class="sc">$</span>eruptions</span>
<span id="cb11-2"><a href=""></a>n<span class="ot">=</span><span class="fu">length</span>(duration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Goal is to estimate the density using histogram and kernel estimation.</li>
</ul>
</section>
<section id="different-kernels" class="slide level2">
<h2>Different Kernels</h2>

<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-11-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="we-can-also-use-ggplot" class="slide level2">
<h2>We can also use ggplot</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-2"><a href=""></a><span class="fu">ggplot</span>(<span class="at">data =</span> faithful, <span class="fu">aes</span>(<span class="at">x =</span> eruptions)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">color=</span> <span class="st">"red"</span>, <span class="at">adjust =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-12-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="different-bandwidth" class="slide level2 smaller">
<h2>Different bandwidth</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a><span class="fu">library</span>(patchwork)</span>
<span id="cb13-2"><a href=""></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> faithful, <span class="fu">aes</span>(<span class="at">x =</span> eruptions)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">adjust =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb13-3"><a href=""></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"adjust = 1/10"</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb13-4"><a href=""></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> faithful, <span class="fu">aes</span>(<span class="at">x =</span> eruptions)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">adjust =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href=""></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"adjust = 1/2"</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb13-6"><a href=""></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-13-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="different-kernels-1" class="slide level2 smaller">
<h2>Different Kernels</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> faithful, <span class="fu">aes</span>(<span class="at">x =</span> eruptions)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">kernel =</span> <span class="st">"gaussian"</span>) <span class="sc">+</span></span>
<span id="cb14-2"><a href=""></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gaussian"</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb14-3"><a href=""></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> faithful, <span class="fu">aes</span>(<span class="at">x =</span> eruptions)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">kernel =</span> <span class="st">"rectangular"</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href=""></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Rectangular"</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb14-5"><a href=""></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-14-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="drawing-kde-manually" class="slide level2">
<h2>Drawing KDE manually</h2>
<ul>
<li><p>We choose a range of values to plot using the minimum and maximum values of the data, and create a sequence of values using the seq() function. We set the bandwidth for the kernel density estimation using the bw variable.</p></li>
<li><p>Next, we use the sapply() function to compute the kernel density estimate for each value in the sequence.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href=""></a><span class="co"># Generate some sample data</span></span>
<span id="cb15-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb15-3"><a href=""></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb15-4"><a href=""></a></span>
<span id="cb15-5"><a href=""></a><span class="co"># Choose a range of values to plot</span></span>
<span id="cb15-6"><a href=""></a>xmin <span class="ot">&lt;-</span> <span class="fu">min</span>(x)</span>
<span id="cb15-7"><a href=""></a>xmax <span class="ot">&lt;-</span> <span class="fu">max</span>(x)</span>
<span id="cb15-8"><a href=""></a>xseq <span class="ot">&lt;-</span> <span class="fu">seq</span>(xmin, xmax, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb15-9"><a href=""></a></span>
<span id="cb15-10"><a href=""></a><span class="co"># Set the bandwidth for the kernel density estimation</span></span>
<span id="cb15-11"><a href=""></a>bw <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb15-12"><a href=""></a></span>
<span id="cb15-13"><a href=""></a><span class="co"># Compute the kernel density estimate</span></span>
<span id="cb15-14"><a href=""></a>kde <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xseq, <span class="cf">function</span>(xi) {</span>
<span id="cb15-15"><a href=""></a>  <span class="fu">mean</span>(<span class="fu">dnorm</span>((xi <span class="sc">-</span> x)<span class="sc">/</span>bw)<span class="sc">/</span>bw)</span>
<span id="cb15-16"><a href=""></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="drawing-kde-manually-1" class="slide level2">
<h2>Drawing KDE manually</h2>
<ul>
<li>The R code on the last slide would produce this KDE.</li>
</ul>

<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-16-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="bivariate-kernel-density-estimation" class="slide level2">
<h2>Bivariate kernel density estimation</h2>
<p>For bivariate data <span class="math inline">\((X_i, Y_i)\)</span>, <span class="math inline">\(i = 1, \dots, n\)</span>, we want to estimate a joint density <span class="math inline">\(f(x, y)\)</span>.</p>
<p>A <strong>bivariate kernel density estimator</strong> is <span class="math display">\[
\hat f(x, y) =
\frac{1}{n |H|^{1/2}}
\sum_{i=1}^n
K\!\left( H^{-1/2}
\begin{pmatrix}
x - X_i \\
y - Y_i
\end{pmatrix}
\right),
\]</span> where</p>
<ul>
<li><span class="math inline">\(K(\cdot)\)</span> is a kernel on <span class="math inline">\(\mathbb{R}^2\)</span>,</li>
<li><span class="math inline">\(H\)</span> is a <span class="math inline">\(2 \times 2\)</span> <strong>bandwidth matrix</strong>, symmetric and positive definite.</li>
</ul>
</section>
<section id="product-kernels-and-bandwidth-matrix" class="slide level2">
<h2>Product kernels and bandwidth matrix</h2>
<p>A simple choice is a <strong>product kernel</strong>: <span class="math display">\[
K(u, v) = K_1(u)\,K_2(v),
\]</span> with univariate kernels <span class="math inline">\(K_1, K_2\)</span>.</p>
<p>If we take a diagonal bandwidth matrix <span class="math display">\[
H =
\begin{pmatrix}
h_x^2 &amp; 0 \\
0 &amp; h_y^2
\end{pmatrix},
\]</span> then <span class="math display">\[
\hat f(x, y)
=
\frac{1}{n h_x h_y}
\sum_{i=1}^n
K_1\!\left(\frac{x - X_i}{h_x}\right)
K_2\!\left(\frac{y - Y_i}{h_y}\right).
\]</span></p>
<ul>
<li><span class="math inline">\(h_x, h_y\)</span> control smoothing in each direction.</li>
<li>A full bandwidth matrix <span class="math inline">\(H\)</span> can capture correlation / anisotropy.</li>
</ul>
</section>
<section id="visualizing-bivariate-kde" class="slide level2">
<h2>Visualizing bivariate KDE</h2>
<p>Common visualizations:</p>
<ul>
<li><strong>Contour plots</strong> of <span class="math inline">\(\hat f(x, y)\)</span>.<br>
</li>
<li><strong>Image / heat maps</strong> (color intensity = density).<br>
</li>
<li>3D <strong>perspective plots</strong>.</li>
</ul>
<p>In R, a convenient workhorse is <code>MASS::kde2d()</code>:</p>
<ul>
<li>Takes vectors <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, bandwidths, and grid resolution.</li>
<li>Returns a list with grid points and estimated density values.</li>
</ul>
</section>
<section id="generic-bivariate-kde" class="slide level2">
<h2>Generic bivariate KDE</h2>

<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-17-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="r-codes" class="slide level2">
<h2>R codes</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a><span class="fu">library</span>(MASS)</span>
<span id="cb16-2"><a href=""></a></span>
<span id="cb16-3"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-4"><a href=""></a></span>
<span id="cb16-5"><a href=""></a><span class="co"># Simulate generic bivariate data </span></span>
<span id="cb16-6"><a href=""></a>n <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb16-7"><a href=""></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.7</span>,</span>
<span id="cb16-8"><a href=""></a>                  <span class="fl">0.7</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb16-9"><a href=""></a>Z <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Sigma =</span> Sigma)</span>
<span id="cb16-10"><a href=""></a>x <span class="ot">&lt;-</span> Z[, <span class="dv">1</span>]</span>
<span id="cb16-11"><a href=""></a>y <span class="ot">&lt;-</span> Z[, <span class="dv">2</span>]</span>
<span id="cb16-12"><a href=""></a></span>
<span id="cb16-13"><a href=""></a><span class="co"># Bivariate KDE on a grid</span></span>
<span id="cb16-14"><a href=""></a>khat <span class="ot">&lt;-</span> <span class="fu">kde2d</span>(x, y, <span class="at">n =</span> <span class="dv">100</span>)  </span>
<span id="cb16-15"><a href=""></a></span>
<span id="cb16-16"><a href=""></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb16-17"><a href=""></a></span>
<span id="cb16-18"><a href=""></a><span class="fu">plot</span>(x, y,</span>
<span id="cb16-19"><a href=""></a>     <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="fl">0.4</span>,</span>
<span id="cb16-20"><a href=""></a>     <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"y"</span>,</span>
<span id="cb16-21"><a href=""></a>     <span class="at">main =</span> <span class="st">"Scatterplot"</span>)</span>
<span id="cb16-22"><a href=""></a></span>
<span id="cb16-23"><a href=""></a><span class="fu">contour</span>(khat<span class="sc">$</span>x, khat<span class="sc">$</span>y, khat<span class="sc">$</span>z,</span>
<span id="cb16-24"><a href=""></a>        <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"y"</span>,</span>
<span id="cb16-25"><a href=""></a>        <span class="at">main =</span> <span class="st">"Bivariate KDE</span><span class="sc">\n</span><span class="st">(Contours)"</span>)</span>
<span id="cb16-26"><a href=""></a></span>
<span id="cb16-27"><a href=""></a><span class="fu">image</span>(khat<span class="sc">$</span>x, khat<span class="sc">$</span>y, khat<span class="sc">$</span>z,</span>
<span id="cb16-28"><a href=""></a>      <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"y"</span>,</span>
<span id="cb16-29"><a href=""></a>      <span class="at">main =</span> <span class="st">"Bivariate KDE</span><span class="sc">\n</span><span class="st">(Heat map)"</span>)</span>
<span id="cb16-30"><a href=""></a><span class="fu">contour</span>(khat<span class="sc">$</span>x, khat<span class="sc">$</span>y, khat<span class="sc">$</span>z,</span>
<span id="cb16-31"><a href=""></a>        <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">drawlabels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-32"><a href=""></a><span class="fu">points</span>(x, y, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="d" class="slide level2">
<h2>3-D</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href=""></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb17-2"><a href=""></a><span class="fu">persp</span>(khat<span class="sc">$</span>x, khat<span class="sc">$</span>y, khat<span class="sc">$</span>z,</span>
<span id="cb17-3"><a href=""></a>      <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"y"</span>, <span class="at">zlab =</span> <span class="st">"f_hat(x, y)"</span>,</span>
<span id="cb17-4"><a href=""></a>      <span class="at">theta =</span> <span class="dv">40</span>, <span class="at">phi =</span> <span class="dv">30</span>,</span>
<span id="cb17-5"><a href=""></a>      <span class="at">expand =</span> <span class="fl">0.6</span>,</span>
<span id="cb17-6"><a href=""></a>      <span class="at">ticktype =</span> <span class="st">"detailed"</span>,</span>
<span id="cb17-7"><a href=""></a>      <span class="at">main =</span> <span class="st">"Bivariate KDE: 3D surface"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-19-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="spatial-kde" class="slide level2">
<h2>Spatial KDE</h2>
<ul>
<li>Here is a “simulated” example:</li>
</ul>

<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-20-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="real-data-chicago-crime" class="slide level2">
<h2>Real data : Chicago Crime</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb18-2"><a href=""></a><span class="fu">library</span>(MASS)</span>
<span id="cb18-3"><a href=""></a></span>
<span id="cb18-4"><a href=""></a>url.data <span class="ot">&lt;-</span> <span class="st">"https://data.cityofchicago.org/api/views/x2n5-8w5q/rows.csv?accessType=DOWNLOAD"</span></span>
<span id="cb18-5"><a href=""></a></span>
<span id="cb18-6"><a href=""></a>crime_raw <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url.data, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>),</span>
<span id="cb18-7"><a href=""></a>                      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-8"><a href=""></a></span>
<span id="cb18-9"><a href=""></a><span class="fu">names</span>(crime_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "CASE."                 "DATE..OF.OCCURRENCE"   "BLOCK"                
 [4] "IUCR"                  "PRIMARY.DESCRIPTION"   "SECONDARY.DESCRIPTION"
 [7] "LOCATION.DESCRIPTION"  "ARREST"                "DOMESTIC"             
[10] "BEAT"                  "WARD"                  "FBI.CD"               
[13] "X.COORDINATE"          "Y.COORDINATE"          "LATITUDE"             
[16] "LONGITUDE"             "LOCATION"             </code></pre>
</div>
</div>
</section>
<section id="filter-to-valid-coordinates" class="slide level2">
<h2>Filter to valid coordinates</h2>
<ul>
<li>Keep only rows with valid lat/lon, same as filtering out locations without an address.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href=""></a>crime_xy <span class="ot">&lt;-</span> crime_raw <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href=""></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(LATITUDE),</span>
<span id="cb20-3"><a href=""></a>         <span class="sc">!</span><span class="fu">is.na</span>(LONGITUDE))</span>
<span id="cb20-4"><a href=""></a></span>
<span id="cb20-5"><a href=""></a><span class="fu">nrow</span>(crime_xy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 237372</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href=""></a><span class="fu">table</span>(crime_xy<span class="sc">$</span>PRIMARY.DESCRIPTION)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                            ARSON                           ASSAULT 
                              375                             21592 
                          BATTERY                          BURGLARY 
                            42864                              9533 
CONCEALED CARRY LICENSE VIOLATION                   CRIMINAL DAMAGE 
                              265                             26266 
          CRIMINAL SEXUAL ASSAULT                 CRIMINAL TRESPASS 
                             1620                              5256 
               DECEPTIVE PRACTICE                          GAMBLING 
                            14338                                14 
                         HOMICIDE                 HUMAN TRAFFICKING 
                              441                                17 
 INTERFERENCE WITH PUBLIC OFFICER                      INTIMIDATION 
                              892                               131 
                       KIDNAPPING              LIQUOR LAW VIOLATION 
                               90                               200 
              MOTOR VEHICLE THEFT                         NARCOTICS 
                            17208                              7522 
                     NON-CRIMINAL                         OBSCENITY 
                                3                                52 
       OFFENSE INVOLVING CHILDREN          OTHER NARCOTIC VIOLATION 
                             1555                                 9 
                    OTHER OFFENSE                      PROSTITUTION 
                            16671                               214 
                 PUBLIC INDECENCY            PUBLIC PEACE VIOLATION 
                               10                              1031 
                          ROBBERY                       SEX OFFENSE 
                             6311                              1259 
                         STALKING                             THEFT 
                              564                             55377 
                WEAPONS VIOLATION 
                             5692 </code></pre>
</div>
</div>
</section>
<section id="different-types-of-crime" class="slide level2">
<h2>Different types of crime</h2>

<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-23-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="theft" class="slide level2">
<h2>Theft</h2>
<ul>
<li><p>Let us look at only theft and also select a few samples for speed.</p></li>
<li><p>Extract coordinates (note: LONGITUDE = x, LATITUDE = y)</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href=""></a>chicago_theft <span class="ot">&lt;-</span> crime_xy <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href=""></a>  <span class="fu">filter</span>(PRIMARY.DESCRIPTION <span class="sc">==</span> <span class="st">"THEFT"</span>)</span>
<span id="cb24-3"><a href=""></a></span>
<span id="cb24-4"><a href=""></a><span class="co"># 3. Subsample (for speed / clarity in plotting)</span></span>
<span id="cb24-5"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb24-6"><a href=""></a>chicago_theft_sub <span class="ot">&lt;-</span> chicago_theft <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href=""></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="fu">min</span>(<span class="dv">15000</span>, <span class="fu">nrow</span>(crime_xy)))</span>
<span id="cb24-8"><a href=""></a></span>
<span id="cb24-9"><a href=""></a>x <span class="ot">&lt;-</span> chicago_theft_sub<span class="sc">$</span>LONGITUDE</span>
<span id="cb24-10"><a href=""></a>y <span class="ot">&lt;-</span> chicago_theft_sub<span class="sc">$</span>LATITUDE</span>
<span id="cb24-11"><a href=""></a></span>
<span id="cb24-12"><a href=""></a><span class="co"># Bivariate KDE over lon–lat</span></span>
<span id="cb24-13"><a href=""></a><span class="co"># Choose grid size; 100x100 is usually plenty</span></span>
<span id="cb24-14"><a href=""></a></span>
<span id="cb24-15"><a href=""></a>kde_chicago <span class="ot">&lt;-</span> <span class="fu">kde2d</span>(x, y,</span>
<span id="cb24-16"><a href=""></a>                     <span class="at">n =</span> <span class="dv">100</span>,</span>
<span id="cb24-17"><a href=""></a>                     <span class="at">lims =</span> <span class="fu">c</span>(<span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb24-18"><a href=""></a>                              <span class="fu">range</span>(y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="finally-plot-the-spatial-kernel-density" class="slide level2">
<h2>Finally, plot the spatial kernel density</h2>

<img data-src="density_estimation_files/figure-revealjs/unnamed-chunk-25-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="kde-and-knn" class="slide level2">
<h2>KDE and KNN</h2>
<ul>
<li><p>Histogram and KDE is intimately connected with a nonparametric classification algorithm called k-nearest neighbors.</p></li>
<li><p><span class="math inline">\(k\)</span>-NN: given a positive integer <span class="math inline">\(k\)</span>, and a new, yet-unforeseen observation <span class="math inline">\(x_0\)</span>, the KNN classifier first identifies the <span class="math inline">\(k\)</span> points in the training data that are closest to <span class="math inline">\(x_0\)</span>, represented by <span class="math inline">\(N_0\)</span>.</p></li>
<li><p>It then estimates the conditional probability for class j as the fraction of points in <span class="math inline">\(N_0\)</span> whose response values equal <span class="math inline">\(j\)</span>:</p></li>
</ul>
<p><span class="math display">\[
P(Y = j | X = x_0) = \frac{1}{k} \sum_{i \in N_0} I(y_i = j)
\]</span></p>
<ul>
<li>Finally, <span class="math inline">\(k\)</span>-NN classifies the test observation <span class="math inline">\(x_0\)</span> to the class with the largest probability.</li>
</ul>
</section>
<section id="knn" class="slide level2">
<h2>KNN</h2>
<p><img src="knn.png" height="600" width="900"></p>
</section>
<section id="knn-vs-kde" class="slide level2">
<h2>KNN vs KDE</h2>
<ul>
<li><p>Think of nearest neighbour as a density estimation strategy.</p></li>
<li><p>In KDE or histogram, we fix an interval or region (V) and calculate how many points lie within (K).</p></li>
<li><p>In K-nearest neighbour, you fix the number of neighbours (K) centered on x, and let the region grow to a volume <span class="math inline">\(V^*\)</span>.</p></li>
<li><p>The region <span class="math inline">\(V^*\)</span> will contain k out of n data points, and we can get: <span class="math display">\[
p(x) \approx \frac{k}{nV^*}
\]</span></p></li>
</ul>
<p>In histogram of KDE, h acts as smoothing parameter, in k-NN, k acts as a smoothing parameter.</p>
</section>
<section id="conclusion" class="slide level2">
<h2>Conclusion</h2>
<ul>
<li><p>These methods KDE or KNN works very well in smaller dimensions and fail miserably in higher dimensions.</p></li>
<li><p>In higher dimension, most of the volume is confined within a small radius and distance and neighbours lose their usual meaning.</p></li>
<li><p>One needs different methods for classifying higher dimensional data.</p></li>
</ul>

</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="vt.png" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="density_estimation_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="density_estimation_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="density_estimation_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="density_estimation_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="density_estimation_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="density_estimation_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="density_estimation_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="density_estimation_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="density_estimation_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="density_estimation_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>